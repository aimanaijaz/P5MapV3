!function(){function e(){("object"!=typeof google||"object"!=typeof google.maps)&&(alert("Error Loading Google Maps API. Please check your connection and try again."),console.log("Unable to connect to Google Maps API"));var e={center:{lat:40.8853,lng:-72.3953},zoom:9};map=new google.maps.Map(document.getElementById("map-canvas"),e),infowindow=new google.maps.InfoWindow({maxWidth:150})}var n=[{name:"Broadway Mall",lat:40.773053,lng:-73.52947,address:"358 N Broadway Mall, Hicksville, NY 11801"},{name:"Walt Whitman Mall",lat:40.822924,lng:-73.410689,address:"160 Walt Whitman Road, Huntington Station, NY 11746"},{name:"Roosevelt Field Mall",lat:40.739971,lng:-73.613576,address:"630 Old Country Road, Garden City, NY 11530"},{name:"Westfield Sunrise Mall",lat:40.682646,lng:-73.434651,address:"1 Sunrise Mall, Massapequa, NY 11758"},{name:"Tanger Outlets Riverhead",lat:40.916964,lng:-72.71078,address:"200 Tanger Mall Drive, Riverhead, NY 11901"},{name:"Bellport Outlet Stores",lat:40.757043,lng:-72.939273,address:"Bellport, NY 11713"},{name:"Westfield South Shore",lat:40.740101,lng:-73.246484,address:"1701 West Sunrise Highway, Bay Shore, NY 11706"},{name:"Smith Haven Mall",lat:40.863093,lng:-73.128888,address:"313 Smith Haven Mall, Lake Grove, NY 11755-1201"},{name:"The Mall at the Source",lat:40.745589,lng:-73.59488,address:"1504 Old Country Road, Westbury, NY 11590"},{name:"Tanger Outlets Deer Park",lat:40.765081,lng:-73.303682,address:"152 The Arches Circle, Deer Park, NY 11729"}],a=function(e){this.name=ko.observable(e.name),this.address=ko.observable(e.address),this.lat=ko.observable(e.lat),this.lng=ko.observable(e.lng),this.marker=new google.maps.Marker({position:new google.maps.LatLng(e.lat,e.lng),title:e.name})},t=function(){function t(e){e.contentString="<div></div><h3>"+e.name()+"</h3><div ><p>Sorry, the information could not be accessed.</p></div>";var n="http://en.wikipedia.org/w/api.php?format=json&action=query&list=search&srsearch=@@querystr@@";$.ajax({crossOrigin:!0,url:n.replace("@@querystr@@",e.name()),dataType:"jsonp",timeout:8e3}).error(function(){e.wikiInfo="Sorry, the information could not be accessed.",e.Url=" ",e.setContentString()}).success(function(n){if(n.query.search.length>0){var a=n.query.search[0].title,t=n.query.search[0].snippet;e.wikiInfo="<b>"+a+"</b>, "+t,e.Url='<a href="http://en.wikipedia.org/w/index.php?title='+a+'"target="_blank"> More Information </a>'}else e.wikiInfo="Sorry, the information you are looking for could not be found on wikipedia.",e.Url=" ";e.setContentString()}),e.setContentString=function(){e.contentString="<div></div><h3>"+e.name()+"</h3><div ><p>"+e.wikiInfo+"</p><p >"+e.Url+"</p></div>"}}function o(e){google.maps.event.addListener(e.marker,"click",function(){infowindow.setContent(e.contentString),infowindow.open(map,e.marker),e.marker.setIcon("images/green-dot.png")})}e();var r=this;this.mallList=ko.observableArray(),n.forEach(function(e){var n=new a(e);t(n),o(n),r.mallList.push(n)}),this.currentMall=ko.observable(this.mallList()[0]),r.query=ko.observable(""),r.addPins=function(){for(var e=0;e<r.mallList().length;e++)r.mallList()[e].marker.setMap(map)},r.addPins(),r.removePins=function(){for(var e=0;e<r.mallList().length;e++)r.mallList()[e].marker.setMap(null)},r.addPin=function(e){e.marker.setMap(map),e.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.marker.setAnimation(google.maps.Animation.NONE),e.marker.setIcon("images/blue-dot.png")},2e3),r.bind=function(){return function(){for(var n=0;n<r.mallList().length;n++)infowindow.setContent(e.contentString),infowindow.open(map,e.marker)}},google.maps.event.addListener(e.marker,"click",r.bind(e.marker))},r.search=ko.computed(function(){return r.query()?(r.removePins(),ko.utils.arrayFilter(r.mallList(),function(e){return e.name().toLowerCase().indexOf(r.query().toLowerCase())>-1?(r.addPin(e),infowindow.setContent(e.contentString),infowindow.open(map,e.marker),e.name):void 0})):r.mallList()}),r.listClick=function(e){r.removePins(),r.addPin(e),infowindow.setContent(e.contentString),infowindow.open(map,e.marker)}};ko.applyBindings(new t)}();